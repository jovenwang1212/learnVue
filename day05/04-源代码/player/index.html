<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>Document</title>
  <link rel="stylesheet" href="./css/index.css" />
  <link rel="stylesheet" href="./css/iconfont.css" />
  <link rel="stylesheet" href="./css/results.css" />
  <link rel="stylesheet" href="./css/player.css">
  <link rel="stylesheet" href="./css/video.css">
  <link rel="stylesheet" href="./css/comment.css">

</head>

<body>
  <div id="player">
    <h2 class="title">黑云音乐</h2>
    <div class="search">
      <input type="text" v-model="keywords" @keyup.enter="queryMusic" />
      <button @click="queryMusic">
        <span class="iconfont icon-search"></span>
      </button>
    </div>
    <div class="tab-wrapper">
      <!-- 对应的内容区域 -->
      <div class="tab-content">
        <router-view></router-view>
      </div>
    </div>
  </div>

  <script src="./lib/vue.js"></script>
  <script src="./lib/vue-router.js"></script>
  <script src="./lib/axios.js"></script>
  <script type="text/x-template" id="result_tpl">
    <div class="result-wrapper">
        <div class="song" v-for="(item, index) in songList" :key="item.id">
          <div class="name">
            <span class="iconfont icon-play"></span>
            {{item.name}}
            <span class="iconfont icon-editmedia" v-show="item.mvid"></span>
          </div>
          <div class="singer">{{item.artists|formatSinger}}</div>
          <div class="album">《{{item.album.name}}》</div>
          <div class="time">{{item.duration|formatTime}}</div>
        </div>
      </div>
  </script>

  <script type="text/x-template" id="music_tpl">
    <div class="player">
        <div class="left">
          <img class='disc' src="./img/disc.png" alt="">
          <img class='cover' src="./img/cover.png" alt="">
        </div>
        <div class="right">
          <div class="title"><img src="./img/tag.png" alt=""><span>放个大招给你看</span> </div>
          <div class="singer">歌手: <span>尼古拉斯赵四</span></div>
          <div class="album">所属专辑: <span>我就是我</span></div>
          <audio class='audio' controls src=""></audio>
          <ul class='lyric-container'>
            <li class='lyric'>难以忘记</li>
            <li class='lyric'>初次见你</li>
            <li class='lyric'>那双迷人的小眼睛</li>
          </ul>
        </div>
      </div>
  </script>
  <script type="text/x-template" id="video_tpl">
    <div class="video">
        <div class="title-wrapper">
          <span class='tag'>MV</span>
          <span class='title'>冲动的惩罚</span>
          <span class='artist'>刀郎</span>
        </div>
        <video src="" controls></video>
      </div>

  </script>
  <script type="text/x-template" id="comment_tpl">
    <div class="comment-wrapper">
        <div class="items">
          <div class="item">
            <div class="left">
              <img src="./img/icon.jpg" alt="">
            </div>
            <div class="right">
              <div class="top">
                <span class='user'>阿木木:</span>
                <span class='content'>写歌的人假正经，唱歌的人最矫情，听歌的人最用心写歌的人假正经，唱歌的人最矫情，听歌的人最用心写歌的人假正经，唱歌的人最矫情，听歌的人最用心写歌的人假正经，唱歌的人最矫情，听歌的人最用心写歌的人假正经，唱歌的人最矫情，听歌的人最用心写歌的人假正经，唱歌的人最矫情，听歌的人最用心写歌的人假正经，唱歌的人最矫情，听歌的人最用心写歌的人假正经，唱歌的人最矫情，听歌的人最用心</span>
              </div>
              <div class="bottom">
                <div class="time">2016年9月18日</div>
                <div class="like-wrapper">
                    <span>👍</span>(6666)
                </div>
              </div>
            </div>
          </div>
          <div class="item">
            <div class="left">
              <img src="./img/icon.jpg" alt="">
            </div>
            <div class="right">
              <div class="top">
                <span class='user'>阿木木:</span>
                <span class='content'>写歌的人假正经，唱歌的人最矫情，听歌的人最用心写歌的人假正经，唱歌的人最矫情，听歌的人最用心写歌的人假正经，唱歌的人最矫情，听歌的人最用心写歌的人假正经，唱歌的人最矫情，听歌的人最用心写歌的人假正经，唱歌的人最矫情，听歌的人最用心写歌的人假正经，唱歌的人最矫情，听歌的人最用心写歌的人假正经，唱歌的人最矫情，听歌的人最用心写歌的人假正经，唱歌的人最矫情，听歌的人最用心</span>
              </div>
              <div class="bottom">
                <div class="time">2016年9月18日</div>
                <div class="like-wrapper">
                    <span>👍</span>(6666)
                </div>
              </div>
            </div>
          </div>
          <div class="item">
            <div class="left">
              <img src="./img/icon.jpg" alt="">
            </div>
            <div class="right">
              <div class="top">
                <span class='user'>阿木木:</span>
                <span class='content'>写歌的人假正经，唱歌的人最矫情，听歌的人最用心写歌的人假正经，唱歌的人最矫情，听歌的人最用心写歌的人假正经，唱歌的人最矫情，听歌的人最用心写歌的人假正经，唱歌的人最矫情，听歌的人最用心写歌的人假正经，唱歌的人最矫情，听歌的人最用心写歌的人假正经，唱歌的人最矫情，听歌的人最用心写歌的人假正经，唱歌的人最矫情，听歌的人最用心写歌的人假正经，唱歌的人最矫情，听歌的人最用心</span>
              </div>
              <div class="bottom">
                <div class="time">2016年9月18日</div>
                <div class="like-wrapper">
                    <span>👍</span>(6666)
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
  </script>
  <script>
    const Result = {
      template: '#result_tpl',
      data() {
        return {
          // 歌曲搜索列表
          songList: []
        }
      },
      filters: {
        formatTime(time) {
          // 毫秒->04：03
          // 取得总秒数
          let totalSec = Math.floor(time / 1000)
          // 取得分 总秒数->分
          let min = Math.floor(totalSec / 60)
          // 总秒数->秒
          let sec = totalSec % 60
          return `${min>=10?min:'0'+min}:${sec>=10?sec:'0'+sec}`
        },
        formatSinger(artists) {
          // let str = ''
          // for (let artist of artists) {
          //   str += artist.name + '|'
          // }
          // return str.substr(0, str.length - 1)
          let arr = []
          for (let artist of artists) {
            arr.push(artist.name)
          }
          return arr.join('|')
        }
      },
      beforeRouteUpdate(to, from, next) {
        axios.get(`https://autumnfish.cn/search?keywords=${to.params.keywords}`)
          .then(res => {
            // console.log(res)
            this.songList = res.data.result.songs
            next()
          })
      },
      created() {
        // console.log('ok')
        // console.log(this.$route.params.keywords)
        axios.get(`https://autumnfish.cn/search?keywords=${this.$route.params.keywords}`)
          .then(res => {
            // console.log(res)
            this.songList = res.data.result.songs
          })
      },
    }
    const Player = {
      template: '#music_tpl'
    }
    const Video = {
      template: '#video_tpl'
    }
    const Comment = {
      template: '#comment_tpl'
    }


    const routes = [{
        path: '/result/:keywords',
        component: Result
      },
      {
        path: '/player',
        component: Player
      },
      {
        path: '/mv',
        component: Video
      },
      {
        path: '/comment',
        component: Comment
      }
    ]

    const router = new VueRouter({
      routes
    })

    const app = new Vue({
      el: '#player',
      router,
      data: {
        // 获取用户输入的关键字
        keywords: '岁月神偷'
      },
      methods: {
        // 显示搜索组件
        queryMusic() {
          router.push(`/result/${this.keywords}`)
        }
      },
    })
  </script>
</body>

</html>